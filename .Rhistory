CI_U_LN<-ConfInt_U
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i],"/ConfInt_D.RData"))
CI_D_LN<-ConfInt_D
conv_LN[i,,]<-converge_LN
conv_count_LN[i,]<-conv_counter_LN
error_ind_LN[i,]<-counter_LN
}
D_RE<-U_RE<-SSB_RE<-matrix(nrow=100, ncol=length(names_DML)*2)
D_fc_RE<-U_fc_RE<-SSB_fc_RE<-matrix(nrow=500, ncol=length(names_DML)*2)
CI_D_DML<-CI_U_DML<-CI_SSB_DML<-converge_DML<-matrix(NA,nrow=100, ncol=length(names_DML))
CI_D_LN<-CI_U_LN<-CI_SSB_LN<-converge_LN<-matrix(NA,nrow=100, ncol=length(names_LN))
for (i in seq(1,length(names_DML)*2,2)){
#Loading DML files
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i/2+0.5],"/D_MRE.RData"))
D_RE[,i]<-D_MRE[,nyear+1]
D_fc_RE[,i]<-c(D_MRE[,(nyear+2):(nyear+6)])
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i/2+0.5],"/SSB_MRE.RData"))
SSB_RE[,i]<-SSB_MRE[,nyear+1]
SSB_fc_RE[,i]<-c(SSB_MRE[,(nyear+2):(nyear+6)])
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i/2+0.5],"/U_MRE.RData"))
U_RE[,i]<-U_MRE[,nyear]
U_fc_RE[,i]<-c(U_MRE[,(nyear+1):(nyear+5)])
#CI
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i/2+0.5],"/ConfInt_D.RData"))
CI_D_DML[1:length(ConfInt_D),i/2+0.5]<-ConfInt_D
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i/2+0.5],"/ConfInt_SSB.RData"))
CI_SSB_DML[1:length(ConfInt_D),i/2+0.5]<-ConfInt_SSB
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i/2+0.5],"/ConfInt_U.RData"))
CI_U_DML[1:length(ConfInt_U),i/2+0.5]<-ConfInt_U
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i/2+0.5],"/converge.RData"))
converge_DML[,i/2+0.5]<-converge[,3]
}
for (i in seq(1,length(names_LN)*2,2)){
#Loading LN files
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i/2+0.5],"/D_MRE.RData"))
D_RE[,i+1]<-D_MRE[,nyear+1]
D_fc_RE[,i+1]<-c(D_MRE[,(nyear+2):(nyear+6)])
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i/2+0.5],"/SSB_MRE.RData"))
SSB_RE[,i+1]<-SSB_MRE[,nyear+1]
SSB_fc_RE[,i+1]<-c(SSB_MRE[,(nyear+2):(nyear+6)])
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i/2+0.5],"/U_MRE.RData"))
U_RE[,i+1]<-U_MRE[,nyear]
U_fc_RE[,i+1]<-c(U_MRE[,(nyear+1):(nyear+5)])
#CI
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i/2+0.5],"/ConfInt_D.RData"))
CI_D_LN[1:length(ConfInt_D),i/2+0.5]<-ConfInt_D
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i/2+0.5],"/ConfInt_SSB.RData"))
CI_SSB_LN[1:length(ConfInt_D),i/2+0.5]<-ConfInt_SSB
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i/2+0.5],"/ConfInt_U.RData"))
CI_U_LN[1:length(ConfInt_U),i/2+0.5]<-ConfInt_U
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i/2+0.5],"/converge.RData"))
converge_LN[,i/2+0.5]<-converge[,3]
}
N_LN<-N_DML<-NA
for(i in 1:length(names_LN)){
N_LN[i]<-length(converge_LN[,i][converge_LN[,i]=="TRUE" & !is.na(converge_LN[,i])])
}
for(i in 1:length(names_DML)){
N_DML[i]<-length(converge_DML[,i][converge_DML[,i]=="TRUE" & !is.na(converge_DML[,i])])
}
CI_Dep_LN<-round(colSums(CI_D_LN,na.rm=TRUE)/N_LN,2)*100
CI_Dep_DML<-round(colSums(CI_D_DML,na.rm=TRUE)/N_DML,2)*100
CI_Exp_LN<-round(colSums(CI_U_LN,na.rm=TRUE)/N_LN,2)*100
CI_Exp_DML<-round(colSums(CI_U_DML,na.rm=TRUE)/N_DML,2)*100
CI_ssb_LN<-round(colSums(CI_SSB_LN,na.rm=TRUE)/N_LN,2)*100
CI_ssb_DML<-round(colSums(CI_SSB_DML,na.rm=TRUE)/N_DML,2)*100
tiff(filename=paste0("C:/Users/nfisch/Documents/Chapter_4/2DSel_2DM_Results/CI.tiff"), height = 12, width = 40, units = 'cm', compression = "lzw", res = 500 )
par(mar=c(3,4,2,2))
#ind_x<-c(1:3,5:7,9:11, 14:16,18:20,22:24, 27:29,31:33,35:37,40:42,44:46,48:50)
#ind_DML<-c(27:29,31:33,35:37,40:42,44:46,48:50)
ind_DML<-c(35:37,48:50)
ind_LN<-c(35:37,48:50)
plot(ind_DML,CI_Dep_DML[c(7:9,16:18)], ylim=c(0,105), xaxt="n", las=1, ylab="CI Coverage", col=3, pch=16, main="CI Coverage", xlab="", xlim=c(1.5,49.5))
points(ind_LN,CI_Dep_LN, col=2, pch=16)
points(ind_DML,CI_ssb_DML[c(7:9,16:18)],pch=1, col=3)
points(ind_LN,CI_ssb_LN, pch=1, col=2)
abline(h=95, lty=2)
abline(v=c(12.5,25.5,38.5), lwd=2)
axis(side=1, at=ind_DML, substr(names_DML,5,8), las=2, cex.axis=0.85)
dev.off()
tiff(filename=paste0("C:/Users/nfisch/Documents/Chapter_4/2DSel_2DM_Results/CI.tiff"), height = 12, width = 40, units = 'cm', compression = "lzw", res = 500 )
par(mar=c(3,4,2,2))
#ind_x<-c(1:3,5:7,9:11, 14:16,18:20,22:24, 27:29,31:33,35:37,40:42,44:46,48:50)
#ind_DML<-c(27:29,31:33,35:37,40:42,44:46,48:50)
ind_DML<-c(35:37,48:50)
ind_LN<-c(35:37,48:50)
plot(ind_DML,CI_Dep_DML[c(7:9,16:18)], ylim=c(0,105), xaxt="n", las=1, ylab="CI Coverage", col=3, pch=16, main="CI Coverage", xlab="", xlim=c(1.5,49.5))
points(ind_LN,CI_Dep_LN, col=2, pch=16)
points(ind_DML,CI_ssb_DML[c(7:9,16:18)],pch=1, col=3)
points(ind_LN,CI_ssb_LN, pch=1, col=2)
abline(h=95, lty=2)
abline(v=c(12.5,25.5,38.5), lwd=2)
axis(side=1, at=ind_LN, substr(names_LN,5,8), las=2, cex.axis=0.85)
mtext(text="OM1", side=3, line=-1, at=6, font=2)
mtext(text="OM2", side=3, line=-1, at=19, font=2)
mtext(text="OM3", side=3, line=-1, at=32, font=2)
mtext(text="OM4", side=3, line=-1, at=45, font=2)
mtext(text=paste0("Depletion - ",intToUtf8(9679)), side=3, line=0, at=6, font=2, cex=0.8)
mtext(text=paste0("Terminal SSB - ",intToUtf8(9675)), side=3, line=0, at=45, font=2, cex=0.8)
mtext(text="DML", side=3, line=0, at=16, font=2, cex=0.8, col="dark green")
mtext(text="LN", side=3, line=0, at=34, font=2, cex=0.8, col="dark red")
dev.off()
tiff(filename=paste0("C:/Users/nfisch/Documents/Chapter_4/2DSel_2DM_Results/Depletion_RE.tiff"), height = 12, width = 40, units = 'cm', compression = "lzw", res = 500 )
par(mar=c(3,4,2,2))
#ind<-c(1:6,8:13,15:20,23:28, 30:35, 37:42,45:50, 52:57, 59:64, 67:72, 74:79,81:86)
# ind_DML<-c(45,47,49, 52,54,56, 59,61,63, 67,69,71, 74,76,78,81,83,85)
ind_DML<-c(59,61,63, 81,83,85)
ind_LN<-c(60,62,64, 82,84,86)
vioplot(D_RE[,c(13,15,17,31,33,35)], at=ind_DML, col="white", rectCol=c(3), border=c(3),xlim=c(3,84), las=1, xaxt="n", lineCol=c("dark green"), main="Relative Error - Terminal Year Depletion",ylim=c(-0.7,0.2),colMed = c("dark green"), pchMed=20)
vioplot(D_RE[,c(2,4,6,8,10,12)],add=TRUE, at=ind_LN, col="white", rectCol=c(2), border=c(2),xlim=c(3,84), las=1, xaxt="n", lineCol=c("dark red"), main="Relative Error - Terminal Year Depletion",ylim=c(-0.7,0.2),colMed = c("dark red"), pchMed=20)
abline(h=0, lty=2)
abline(v=c(21.5,43.5,65.5), lwd=2)
ind<-c(seq(59.5,63.5,2),seq(81.5,85.5,2))
axis(side=1, at=ind_LN, substr(names_LN,5,8), las=2, cex.axis=0.8)
legend(x=40,y=0.425, c("DML", "LN"), bg="white", fill=c(3,2), box.col = "white")
mtext(text="Relative Error - Depletion", side=2, line=3, cex=1.2)
mtext(text="OM1", side=3, line=-1, at=10, font=2)
mtext(text="OM2", side=3, line=-1, at=32, font=2)
mtext(text="OM3", side=3, line=-1, at=54, font=2)
mtext(text="OM4", side=3, line=-1, at=76, font=2)
dev.off()
tiff(filename=paste0("C:/Users/nfisch/Documents/Chapter_4/2DSel_2DM_Results/SSB_RE.tiff"), height = 12, width = 40, units = 'cm', compression = "lzw", res = 500 )
par(mar=c(3,4,2,2))
#ind<-c(1:6,8:13,15:20,23:28, 30:35, 37:42,45:50, 52:57, 59:64, 67:72, 74:79,81:86)
# ind_DML<-c(45,47,49, 52,54,56, 59,61,63, 67,69,71, 74,76,78,81,83,85)
ind_DML<-c(59,61,63, 81,83,85)
ind_LN<-c(60,62,64, 82,84,86)
vioplot(SSB_RE[,c(13,15,17,31,33,35)], at=ind, col="white", rectCol=3, border=3, las=1, xaxt="n", lineCol=c("dark green"), main="Relative Error - Terminal Year SSB",ylim=c(-0.35,0.35), xlim=c(3,84),colMed = c("dark green"), pchMed=20)
vioplot(SSB_RE[,c(2,4,6,8,10,12)], add=TRUE,at=ind, col="white", rectCol=2, border=2, las=1, xaxt="n", lineCol=c("dark red"), main="Relative Error - Terminal Year SSB",ylim=c(-0.35,0.35), xlim=c(3,84),colMed = c("dark red"), pchMed=20)
abline(h=0, lty=2)
abline(v=c(21.5,43.5,65.5), lwd=2)
ind<-c(seq(59.5,63.5,2),seq(81.5,85.5,2))
axis(side=1, at=ind_LN, substr(names_LN,5,8), las=2, cex.axis=0.8)
legend(x=41,y=0.375, c("DML", "LN"), bg="white", fill=c(3,2), box.col = "white")
mtext(text="Relative Error - SSB", side=2, line=3, cex=1.2)
mtext(text="OM1", side=3, line=-1, at=10, font=2)
mtext(text="OM2", side=3, line=-1, at=32, font=2)
mtext(text="OM3", side=3, line=-1, at=54, font=2)
mtext(text="OM4", side=3, line=-1, at=76, font=2)
dev.off()
tiff(filename=paste0("C:/Users/nfisch/Documents/Chapter_4/2DSel_2DM_Results/SSB_RE.tiff"), height = 12, width = 40, units = 'cm', compression = "lzw", res = 500 )
par(mar=c(3,4,2,2))
#ind<-c(1:6,8:13,15:20,23:28, 30:35, 37:42,45:50, 52:57, 59:64, 67:72, 74:79,81:86)
# ind_DML<-c(45,47,49, 52,54,56, 59,61,63, 67,69,71, 74,76,78,81,83,85)
ind_DML<-c(59,61,63, 81,83,85)
ind_LN<-c(60,62,64, 82,84,86)
vioplot(SSB_RE[,c(13,15,17,31,33,35)], at=ind_DML, col="white", rectCol=3, border=3, las=1, xaxt="n", lineCol=c("dark green"), main="Relative Error - Terminal Year SSB",ylim=c(-0.35,0.35), xlim=c(3,84),colMed = c("dark green"), pchMed=20)
vioplot(SSB_RE[,c(2,4,6,8,10,12)], add=TRUE,at=ind_LN, col="white", rectCol=2, border=2, las=1, xaxt="n", lineCol=c("dark red"), main="Relative Error - Terminal Year SSB",ylim=c(-0.35,0.35), xlim=c(3,84),colMed = c("dark red"), pchMed=20)
abline(h=0, lty=2)
abline(v=c(21.5,43.5,65.5), lwd=2)
ind<-c(seq(59.5,63.5,2),seq(81.5,85.5,2))
axis(side=1, at=ind_LN, substr(names_LN,5,8), las=2, cex.axis=0.8)
legend(x=41,y=0.375, c("DML", "LN"), bg="white", fill=c(3,2), box.col = "white")
mtext(text="Relative Error - SSB", side=2, line=3, cex=1.2)
mtext(text="OM1", side=3, line=-1, at=10, font=2)
mtext(text="OM2", side=3, line=-1, at=32, font=2)
mtext(text="OM3", side=3, line=-1, at=54, font=2)
mtext(text="OM4", side=3, line=-1, at=76, font=2)
dev.off()
names_DML<-c("OM12SM11EM1111_wsurv","OM12SM12EM1111_wsurv","OM12SM13EM1111_wsurv","OM12SM21EM1111_wsurv","OM12SM22EM1111_wsurv","OM12SM23EM1111_wsurv","OM12SM31EM1111_wsurv","OM12SM32EM1111_wsurv","OM12SM33EM1111_wsurv",
"OM22SM11EM1111_wsurv","OM22SM12EM1111_wsurv","OM22SM13EM1111_wsurv","OM22SM21EM1111_wsurv","OM22SM22EM1111_wsurv","OM22SM23EM1111_wsurv","OM22SM31EM1111_wsurv","OM22SM32EM1111_wsurv","OM22SM33EM1111_wsurv",
"OM32SM11EM1111_wsurv","OM32SM12EM1111_wsurv","OM32SM13EM1111_wsurv","OM32SM21EM1111_wsurv","OM32SM22EM1111_wsurv","OM32SM23EM1111_wsurv","OM32SM31EM1111_wsurv","OM32SM32EM1111_wsurv","OM32SM33EM1111_wsurv",
"OM42SM11EM1111_wsurv","OM42SM12EM1111_wsurv","OM42SM13EM1111_wsurv","OM42SM21EM1111_wsurv","OM42SM22EM1111_wsurv","OM42SM23EM1111_wsurv","OM42SM31EM1111_wsurv","OM42SM32EM1111_wsurv","OM42SM33EM1111_wsurv")
names_LN<-c("OM12SM11EM1112_wsurv","OM12SM12EM1112_wsurv","OM12SM13EM1112_wsurv","OM12SM21EM1112_wsurv","OM12SM22EM1112_wsurv","OM12SM23EM1112_wsurv","OM12SM31EM1112_wsurv","OM12SM32EM1112_wsurv","OM12SM33EM1112_wsurv",
"OM22SM11EM1112_wsurv","OM22SM12EM1112_wsurv","OM22SM13EM1112_wsurv","OM22SM21EM1112_wsurv","OM22SM22EM1112_wsurv","OM22SM23EM1112_wsurv","OM22SM31EM1112_wsurv","OM22SM32EM1112_wsurv","OM22SM33EM1112_wsurv",
"OM32SM11EM1112_wsurv","OM32SM12EM1112_wsurv","OM32SM13EM1112_wsurv","OM32SM21EM1112_wsurv","OM32SM22EM1112_wsurv","OM32SM23EM1112_wsurv","OM32SM31EM1112_wsurv","OM32SM32EM1112_wsurv","OM32SM33EM1112_wsurv",
"OM42SM11EM1112_wsurv","OM42SM12EM1112_wsurv","OM42SM13EM1112_wsurv","OM42SM21EM1112_wsurv","OM42SM22EM1112_wsurv","OM42SM23EM1112_wsurv","OM42SM31EM1112_wsurv","OM42SM32EM1112_wsurv","OM42SM33EM1112_wsurv")
#Full time series plots
conv_DML<-conv_LN<-array(NA,dim=c(length(names_DML),100,3))
conv_count_LN<-conv_count_DML<-matrix(NA, nrow=length(names_DML), ncol=100)
error_ind_LN<-error_ind_DML<-matrix(NA, nrow=length(names_DML), ncol=100)
nyear<-80
library(vioplot)
par(mfcol=c(9,4), mar=c(1,1,1,1), oma=c(3,3,1,1))
for (i in 1:length(names_DML)){
#Loading DML files
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i],"/conv_counter.RData"))
conv_counter_DML<-conv_counter
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i],"/converge.RData"))
converge_DML<-converge
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i],"/diagnostics.RData"))
diagnostics_DML<-diagnostics
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i],"/counter.RData"))
counter_DML<-counter
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i],"/pars.save.RData"))
pars.save_DML<-pars.save
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i],"/SSB_MRE.RData"))
SSB_RE_DML<-SSB_MRE
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i],"/D_MRE.RData"))
D_RE_DML<-D_MRE
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i],"/U_MRE.RData"))
U_RE_DML<-U_MRE
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i],"/ConfInt_SSB.RData"))
CI_SSB_DML<-ConfInt_SSB
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i],"/ConfInt_U.RData"))
CI_U_DML<-ConfInt_U
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i],"/ConfInt_D.RData"))
CI_D_DML<-ConfInt_D
#Loading LN files
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i],"/conv_counter.RData"))
conv_counter_LN<-conv_counter
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i],"/converge.RData"))
converge_LN<-converge
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i],"/diagnostics.RData"))
diagnostics_LN<-diagnostics
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i],"/counter.RData"))
counter_LN<-counter
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i],"/pars.save.RData"))
pars.save_LN<-pars.save
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i],"/SSB_MRE.RData"))
SSB_RE_LN<-SSB_MRE
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i],"/D_MRE.RData"))
D_RE_LN<-D_MRE
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i],"/U_MRE.RData"))
U_RE_LN<-U_MRE
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i],"/ConfInt_SSB.RData"))
CI_SSB_LN<-ConfInt_SSB
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i],"/ConfInt_U.RData"))
CI_U_LN<-ConfInt_U
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i],"/ConfInt_D.RData"))
CI_D_LN<-ConfInt_D
#   if(i %in% c(1:9)){
#    boxplot(D_MRE, ylim=c(-0.3,0.3), las=1, main=paste0(substr(names[i],1,8)), xaxt='n')
#  } else{
#    boxplot(D_MRE, ylim=c(-0.3,0.3), las=1, main=paste0(substr(names[i],1,8)), xaxt='n', yxt="n")
#  }
#  abline(h=0)
#  abline(v=dim(D_RE_DML)[2]-4.5, lwd=2, col=2)
#    mtext(paste0(round(sum(ConfInt_D, na.rm=T)/length(converge[,3][converge[,3]=="TRUE" & !is.na(converge[,3])]),2)*100,"%"),side=3, line=-1.5, cex=0.9)
#    mtext(paste0(length(converge[,3][converge[,3]=="TRUE" & !is.na(converge[,3])])),side=3, line=-2.75, cex=0.9)
#  if(i %in% c(1:9)){
#  boxplot(SSB_MRE, ylim=c(-0.3,0.3), las=1, main=paste0(substr(names[i],1,8)), xaxt="n")
#  } else{
#  boxplot(SSB_MRE, ylim=c(-0.3,0.3), las=1, main=paste0(substr(names[i],1,8)), xaxt="n", yaxt="n")
#  }
#  abline(h=0)
#  abline(v=dim(SSB_MRE)[2]-4.5, lwd=2, col=2)
#  mtext(paste0(round(sum(ConfInt_SSB, na.rm=T)/length(converge[,3][converge[,3]=="TRUE" & !is.na(converge[,3])]),2)*100,"%"),side=3, line=-1.5, cex=0.9)
#  mtext(paste0(length(converge[,3][converge[,3]=="TRUE" & !is.na(converge[,3])])),side=3, line=-2.75, cex=0.9)
#  if(i %in% c(1:9)){
#  boxplot(U_MRE, ylim=c(-0.4,0.4), las=1, main=paste0(substr(names[i],1,8)), xaxt="n")
#  } else {
#  boxplot(U_MRE, ylim=c(-0.4,0.4), las=1, main=paste0(substr(names[i],1,8)), xaxt="n", yaxt="n")
#  }
#  abline(h=0)
#  abline(v=dim(U_MRE)[2]-4.5, lwd=2, col=2)
#  mtext(paste0(round(sum(ConfInt_U, na.rm=T)/length(converge[,3][converge[,3]=="TRUE" & !is.na(converge[,3])]),2)*100,"%"),side=3, line=-1.5, cex=0.9)
#  mtext(paste0(length(converge[,3][converge[,3]=="TRUE" & !is.na(converge[,3])])),side=3, line=-2.75, cex=0.9)
conv_DML[i,,]<-converge_DML
conv_count_DML[i,]<-conv_counter_DML
error_ind_DML[i,]<-counter_DML
conv_LN[i,,]<-converge_LN
conv_count_LN[i,]<-conv_counter_LN
error_ind_LN[i,]<-counter_LN
}
D_RE<-U_RE<-SSB_RE<-matrix(nrow=100, ncol=length(names_DML)*2)
D_fc_RE<-U_fc_RE<-SSB_fc_RE<-matrix(nrow=500, ncol=length(names_DML)*2)
CI_D_DML<-CI_D_LN<-CI_U_DML<-CI_U_LN<-CI_SSB_DML<-CI_SSB_LN<-converge_DML<-converge_LN<-matrix(NA,nrow=100, ncol=length(names_DML))
for (i in seq(1,length(names_DML)*2,2)){
#Loading DML files
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i/2+0.5],"/D_MRE.RData"))
D_RE[,i]<-D_MRE[,nyear+1]
D_fc_RE[,i]<-c(D_MRE[,(nyear+2):(nyear+6)])
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i/2+0.5],"/SSB_MRE.RData"))
SSB_RE[,i]<-SSB_MRE[,nyear+1]
SSB_fc_RE[,i]<-c(SSB_MRE[,(nyear+2):(nyear+6)])
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i/2+0.5],"/U_MRE.RData"))
U_RE[,i]<-U_MRE[,nyear]
U_fc_RE[,i]<-c(U_MRE[,(nyear+1):(nyear+5)])
#CI
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i/2+0.5],"/ConfInt_D.RData"))
CI_D_DML[1:length(ConfInt_D),i/2+0.5]<-ConfInt_D
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i/2+0.5],"/ConfInt_SSB.RData"))
CI_SSB_DML[1:length(ConfInt_D),i/2+0.5]<-ConfInt_SSB
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i/2+0.5],"/ConfInt_U.RData"))
CI_U_DML[1:length(ConfInt_U),i/2+0.5]<-ConfInt_U
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_DML[i/2+0.5],"/converge.RData"))
converge_DML[,i/2+0.5]<-converge[,3]
#Loading LN files
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i/2+0.5],"/D_MRE.RData"))
D_RE[,i+1]<-D_MRE[,nyear+1]
D_fc_RE[,i+1]<-c(D_MRE[,(nyear+2):(nyear+6)])
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i/2+0.5],"/SSB_MRE.RData"))
SSB_RE[,i+1]<-SSB_MRE[,nyear+1]
SSB_fc_RE[,i+1]<-c(SSB_MRE[,(nyear+2):(nyear+6)])
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i/2+0.5],"/U_MRE.RData"))
U_RE[,i+1]<-U_MRE[,nyear]
U_fc_RE[,i+1]<-c(U_MRE[,(nyear+1):(nyear+5)])
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i/2+0.5],"/ConfInt_D.RData"))
CI_D_LN[1:length(ConfInt_D),i/2+0.5]<-ConfInt_D
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i/2+0.5],"/ConfInt_SSB.RData"))
CI_SSB_LN[1:length(ConfInt_D),i/2+0.5]<-ConfInt_SSB
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i/2+0.5],"/ConfInt_U.RData"))
CI_U_LN[1:length(ConfInt_U),i/2+0.5]<-ConfInt_U
load(paste0("C:/Users/nfisch/Documents/Chapter_4/Results/",names_LN[i/2+0.5],"/converge.RData"))
converge_LN[,i/2+0.5]<-converge[,3]
}
N_DML<-N_LN<-NA
for(i in 1:length(names_DML)){
N_DML[i]<-length(converge_DML[,i][converge_DML[,i]=="TRUE" & !is.na(converge_DML[,i])])
N_LN[i]<-length(converge_LN[,i][converge_LN[,i]=="TRUE" & !is.na(converge_LN[,i])])
}
CI_Dep_DML<-round(colSums(CI_D_DML,na.rm=TRUE)/N_DML,2)*100
CI_Dep_LN<-round(colSums(CI_D_LN,na.rm=TRUE)/N_LN,2)*100
CI_Exp_DML<-round(colSums(CI_U_DML,na.rm=TRUE)/N_DML,2)*100
CI_Exp_LN<-round(colSums(CI_U_LN,na.rm=TRUE)/N_LN,2)*100
CI_ssb_DML<-round(colSums(CI_SSB_DML,na.rm=TRUE)/N_DML,2)*100
CI_ssb_LN<-round(colSums(CI_SSB_LN,na.rm=TRUE)/N_LN,2)*100
tiff(filename=paste0("C:/Users/nfisch/Documents/Chapter_4/80yr_Results/Depletion_RE.tiff"), height = 12, width = 40, units = 'cm', compression = "lzw", res = 500 )
par(mar=c(3,4,2,2))
ind<-c(1:6,8:13,15:20,23:28, 30:35, 37:42,45:50, 52:57, 59:64, 67:72, 74:79,81:86)
vioplot(D_RE, at=ind, col="white", rectCol=c(3,2), border=c(3,2),xlim=c(3,84), las=1, xaxt="n", lineCol=c("dark green" ,"dark red"), main="Relative Error - Terminal Year Depletion",ylim=c(-0.8,0.3),colMed = c("dark green","dark red"), pchMed=20)
abline(h=0, lty=2)
abline(v=c(21.5,43.5,65.5), lwd=2)
ind<-c(seq(1.5,5.5,2), seq(8.5,12.5,2), seq(15.5,19.5,2), seq(23.5,27.5,2), seq(30.5,34.5,2), seq(37.5,41.5,2),seq(45.5,49.5,2), seq(52.5,56.5,2), seq(59.5,63.5,2), seq(67.5,71.5,2), seq(74.5,78.5,2),seq(81.5,85.5,2))
axis(side=1, at=ind, substr(names_DML,5,8), las=2, cex.axis=0.8)
legend(x=38.5,y=0.34, c("Dirichlet-multinomial", "Logistic-normal"), bg="white", fill=c(3,2), box.col = "white")
mtext(text="Relative Error - Depletion", side=2, line=3, cex=1.2)
mtext(text="OM1", side=3, line=-1, at=10, font=2)
mtext(text="OM2", side=3, line=-1, at=32, font=2)
mtext(text="OM3", side=3, line=-1, at=54, font=2)
mtext(text="OM4", side=3, line=-1, at=76, font=2)
dev.off()
tiff(filename=paste0("C:/Users/nfisch/Documents/Chapter_4/80yr_Results/SSB_RE.tiff"), height = 12, width = 40, units = 'cm', compression = "lzw", res = 500 )
par(mar=c(3,4,2,2))
ind<-c(1:6,8:13,15:20,23:28, 30:35, 37:42,45:50, 52:57, 59:64, 67:72, 74:79,81:86)
vioplot(SSB_RE, at=ind, col="white", rectCol=3:2, border=3:2, las=1, xaxt="n", lineCol=c("dark green", "dark red"), main="Relative Error - Terminal Year SSB",ylim=c(-0.6,0.6), xlim=c(3,84),colMed = c("dark green", "dark red"), pchMed=20)
abline(h=0, lty=2)
abline(v=c(21.5,43.5,65.5), lwd=2)
ind<-c(seq(1.5,5.5,2), seq(8.5,12.5,2), seq(15.5,19.5,2), seq(23.5,27.5,2), seq(30.5,34.5,2), seq(37.5,41.5,2),seq(45.5,49.5,2), seq(52.5,56.5,2), seq(59.5,63.5,2), seq(67.5,71.5,2), seq(74.5,78.5,2),seq(81.5,85.5,2))
axis(side=1, at=ind, substr(names_DML,5,8), las=2, cex.axis=0.8)
legend(x=38.5,y=0.64, c("Dirichlet-multinomial", "Logistic-normal"), bg="white", fill=c(3,2), box.col = "white")
mtext(text="Relative Error - SSB", side=2, line=3, cex=1.2)
mtext(text="OM1", side=3, line=-1, at=10, font=2)
mtext(text="OM2", side=3, line=-1, at=32, font=2)
mtext(text="OM3", side=3, line=-1, at=54, font=2)
mtext(text="OM4", side=3, line=-1, at=76, font=2)
dev.off()
wd<-"C:/Users/nfisch/Documents/GitHub/CKMR_Project/"
load(paste0(wd,"/Cod_wdat_N200_Ind25_ckmrmultinom25_1.RData"))
load(paste0(wd,"/Flatfish_wdat_N200_Ind25_ckmrmultinom25_1.RData"))
load(paste0(wd,"/Sardine_wdat_N200_Ind25_ckmrmultinom25_1.RData"))
Cod_OM<-Cod_wdat
Flatfish_OM<-Flatfish_wdat
Sardine_OM<-Sardine_wdat
Cod_OM[[1]]$n_ckmr
dim(Cod_OM[[1]]$n_ckmr)
length(Cod_OM[[1]]$n_ckmr)
length(Flatfish_OM[[1]]$n_ckmr)
length(Sardine_OM[[1]]$n_ckmr)
length(Cod_OM[[1]]$age_diff)
length(Flatfish_OM[[1]]$age_diff)
length(Sardine_OM[[1]]$age_diff)
library(TMB)
setwd(wd)
#Compile and load model
compile("CKMRmultinom_HSP_and_POP_Fisch_wAge0.cpp")
N_sim<-1:1
res_list<-list()
for (Q in 3:3){  #Running through the life history types
res_list[[Q]]<-list()
for (s in N_sim){
if(Q==1){
OM<-Cod_OM[[s]]
} else if (Q==2){
OM<-Flatfish_OM[[s]]
}else if (Q==3){
OM<-Sardine_OM[[s]]
}
dat<-list(fyear=OM$OM$fyear, lyear=75, fage=OM$OM$fage, lage=OM$OM$lage,
years=OM$OM$fyear:75, ages=OM$OM$fage:OM$OM$lage,
obs_harv=OM$Obs_Catch,
obs_index=OM$Obs_Index,
obs_fishery_comp=OM$Obs_Catch_Comp/rowSums(OM$Obs_Catch_Comp),
SS_fishery=rowSums(OM$Obs_Catch_Comp),
Mat=OM$OM$Mat,
Laa=OM$OM$Laa,
Waa=OM$OM$Waa,
#CKMR
born_year_old=OM$born_year_old-(OM$fyear_dat-1),
age_diff=OM$age_diff,
n_ckmr=OM$n_ckmr,
k_ckmr_hsp=OM$k_ckmr_hsp,
born_year_young=OM$born_year_young-(OM$fyear_dat-1),
k_ckmr_pop=OM$k_ckmr_pop,
samp_year_old=OM$samp_year_old-(OM$fyear_dat-1))
#Parameters
set.seed(s)
par <- list(log_M=log(runif(1,min=OM$OM$Mref-OM$OM$Mref*0.2,max=OM$OM$Mref+OM$OM$Mref*0.2)),
log_q=log(runif(1,min=OM$q_index-OM$q_index*0.2,max=OM$q_index+OM$q_index*0.2)),
log_recruit_devs_init=rep(0,dat$lage),
log_recruit_devs=rep(0,dat$lyear),
steepness=OM$OM$h,
log_R0=log(runif(1,min=OM$OM$R0-OM$OM$R0*0.2,max=OM$OM$R0+OM$OM$R0*0.2)),
log_sigma_rec=log(OM$OM$sd_rec),
log_sd_catch=log(OM$sd_catch),
log_sd_index=log(OM$sd_index),
Sel_logis_k=log(runif(1,min=OM$OM$Sel_slope-OM$OM$Sel_slope*0.2,max=OM$OM$Sel_slope+OM$OM$Sel_slope*0.2)),
Sel_logis_midpt=log(runif(1,min=OM$OM$Sel_50-OM$OM$Sel_50*0.2,max=OM$OM$Sel_50+OM$OM$Sel_50*0.2)),
log_fint=log(runif(length(OM$OM$F_int[26:100]),min=OM$OM$F_int[26:100]-OM$OM$F_int[26:100]*0.2,max=OM$OM$F_int[26:100]+OM$OM$F_int[26:100]*0.2)))
dyn.load(dynlib("CKMRmultinom_HSP_and_POP_Fisch_wAge0"))
parm_names<-names(MakeADFun(dat, par, DLL="CKMRmultinom_HSP_and_POP_Fisch_wAge0")$par)
fixed<-list(steepness=factor(NA),
log_sd_catch=factor(NA),
log_sd_index=factor(NA))
lower_bounds<-c(-5,-20,rep(-10,dat$lage),rep(-10,dat$lyear), 0, 5, -5,-5,-5,-5,-5,rep(-10,dat$lyear))
upper_bounds<-c( 2,  1,rep( 10,dat$lage),rep( 10,dat$lyear), 1, 25, 2, 2, 2, 5, 5,rep(  0,dat$lyear))
reffects=c("log_recruit_devs","log_recruit_devs_init")
l<-lower_bounds[-which(parm_names %in% c(names(fixed),reffects))]
u<-upper_bounds[-which(parm_names %in% c(names(fixed),reffects))]
SCAA <- MakeADFun(dat, par, DLL="CKMRmultinom_HSP_and_POP_Fisch_wAge0", map=fixed, random=reffects)
SCAA_fit <- TMBhelper::fit_tmb(obj=SCAA, startpar=SCAA$par, lower=l, upper=u, newtonsteps=1, getsd=TRUE,bias.correct=TRUE,getHessian=TRUE)
}
}
-1*(Sardine_OM[[1]]$n_ckmr[i]*((Sardine_OM[[1]]$n_ckmr[i]-(Sardine_OM[[1]]$k_ckmr_hsp[i]+Sardine_OM[[1]]$k_ckmr_pop[i]))/Sardine_OM[[1]]$n_ckmr[i])*log(1-(0.2+0.1)))
-1*(Sardine_OM[[1]]$n_ckmr[1]*((Sardine_OM[[1]]$n_ckmr[1]-(Sardine_OM[[1]]$k_ckmr_hsp[1]+Sardine_OM[[1]]$k_ckmr_pop[1]))/Sardine_OM[[1]]$n_ckmr[1])*log(1-(0.2+0.1)))
-1*(Sardine_OM[[1]]$n_ckmr[1]*((Sardine_OM[[1]]$k_ckmr_hsp[1]/Sardine_OM[[1]]$n_ckmr[1])*log(0.2)))
Sardine_OM[[1]]$n_ckmr[1]
Sardine_OM[[1]]$n_ckmr[50]
-1*(Sardine_OM[[1]]$n_ckmr[50]*((Sardine_OM[[1]]$n_ckmr[50]-(Sardine_OM[[1]]$k_ckmr_hsp[50]+Sardine_OM[[1]]$k_ckmr_pop[50]))/Sardine_OM[[1]]$n_ckmr[50])*log(1-(0.2+0.1)))
-1*(Sardine_OM[[1]]$n_ckmr[50]*((Sardine_OM[[1]]$k_ckmr_hsp[50]/Sardine_OM[[1]]$n_ckmr[50])*log(0.2)))
-1*(Sardine_OM[[1]]$n_ckmr[50]*((Sardine_OM[[1]]$k_ckmr_pop[50]/Sardine_OM[[1]]$n_ckmr[50])*log(0.1)))
Sardine_OM[[1]]$k_ckmr_pop
load(paste0(wd,"/Cod_wdat_N1000_Ind25_ckmrmultinom25_1.RData"))
load(paste0(wd,"/Flatfish_wdat_N1000_Ind25_ckmrmultinom25_1.RData"))
load(paste0(wd,"/Sardine_wdat_N1000_Ind25_ckmrmultinom25_1.RData"))
Cod_OM<-Cod_wdat
Flatfish_OM<-Flatfish_wdat
Sardine_OM<-Sardine_wdat
-1*(Sardine_OM[[1]]$n_ckmr[50]*((Sardine_OM[[1]]$n_ckmr[50]-(Sardine_OM[[1]]$k_ckmr_hsp[50]+Sardine_OM[[1]]$k_ckmr_pop[50]))/Sardine_OM[[1]]$n_ckmr[50])*log(1-(0.2+0.1)))
-1*(Sardine_OM[[1]]$n_ckmr[50]*((Sardine_OM[[1]]$k_ckmr_hsp[50]/Sardine_OM[[1]]$n_ckmr[50])*log(0.2)))
-1*(Sardine_OM[[1]]$n_ckmr[50]*((Sardine_OM[[1]]$k_ckmr_pop[50]/Sardine_OM[[1]]$n_ckmr[50])*log(0.1)))
Sardine_OM[[1]]$k_ckmr_pop
Sardine_OM[[1]]$k_ckmr_hsp
Flatfish_OM[[1]]$k_ckmr_hsp
Flatfish_OM[[1]]$k_ckmr_pop
-1*(Flatfish_OM[[1]]$n_ckmr[804]*((Flatfish_OM[[1]]$n_ckmr[804]-(Flatfish_OM[[1]]$k_ckmr_hsp[804]+Flatfish_OM[[1]]$k_ckmr_pop[804]))/Flatfish_OM[[1]]$n_ckmr[804])*log(1-(0.2+0.1)))
-1*(Flatfish_OM[[1]]$n_ckmr[804]*((Flatfish_OM[[1]]$k_ckmr_hsp[804]/Flatfish_OM[[1]]$n_ckmr[804])*log(0.2)))
-1*(Flatfish_OM[[1]]$n_ckmr[804]*((Flatfish_OM[[1]]$k_ckmr_pop[804]/Flatfish_OM[[1]]$n_ckmr[804])*log(0.1)))
-1*( Flatfish_OM[[1]]$n_ckmr[804] * ((Flatfish_OM[[1]]$n_ckmr[804]-(Flatfish_OM[[1]]$k_ckmr_hsp[804]+Flatfish_OM[[1]]$k_ckmr_pop[804]))/Flatfish_OM[[1]]$n_ckmr[804])*log(1-(0.3)) * ((Flatfish_OM[[1]]$k_ckmr_hsp[804]/Flatfish_OM[[1]]$n_ckmr[804])*log(0.2)) * (Flatfish_OM[[1]]$k_ckmr_pop[804]/Flatfish_OM[[1]]$n_ckmr[804])*log(0.1) )
-1*dmultinom(x=c(Flatfish_OM[[1]]$n_ckmr[804]-(Flatfish_OM[[1]]$k_ckmr_hsp[804]+Flatfish_OM[[1]]$k_ckmr_pop[804]), Flatfish_OM[[1]]$k_ckmr_hsp[804], Flatfish_OM[[1]]$k_ckmr_pop[804]) ,size=Flatfish_OM[[1]]$n_ckmr[804], prob=c(0.7,0.2,0.1), log=TRUE )
76760.37+8.04719+87.49823
-1*dmultinom(x=c(Flatfish_OM[[1]]$n_ckmr[804]-(Flatfish_OM[[1]]$k_ckmr_hsp[804]+Flatfish_OM[[1]]$k_ckmr_pop[804]), Flatfish_OM[[1]]$k_ckmr_hsp[804], Flatfish_OM[[1]]$k_ckmr_pop[804]), prob=c(0.7,0.2,0.1), log=TRUE )
load(paste0(wd,"/Cod_wdat_N200_Ind25_ckmrmultinom25_1.RData"))
load(paste0(wd,"/Flatfish_wdat_N200_Ind25_ckmrmultinom25_1.RData"))
load(paste0(wd,"/Sardine_wdat_N200_Ind25_ckmrmultinom25_1.RData"))
Cod_OM<-Cod_wdat
Flatfish_OM<-Flatfish_wdat
Sardine_OM<-Sardine_wdat
#TMB Section
library(TMB)
setwd(wd)
#Compile and load model
compile("CKMRmultinom_HSP_and_POP_Fisch_wAge0.cpp")
N_sim<-1:1
res_list<-list()
for (Q in 2:2){  #Running through the life history types
res_list[[Q]]<-list()
for (s in N_sim){
if(Q==1){
OM<-Cod_OM[[s]]
} else if (Q==2){
OM<-Flatfish_OM[[s]]
}else if (Q==3){
OM<-Sardine_OM[[s]]
}
dat<-list(fyear=OM$OM$fyear, lyear=75, fage=OM$OM$fage, lage=OM$OM$lage,
years=OM$OM$fyear:75, ages=OM$OM$fage:OM$OM$lage,
obs_harv=OM$Obs_Catch,
obs_index=OM$Obs_Index,
obs_fishery_comp=OM$Obs_Catch_Comp/rowSums(OM$Obs_Catch_Comp),
SS_fishery=rowSums(OM$Obs_Catch_Comp),
Mat=OM$OM$Mat,
Laa=OM$OM$Laa,
Waa=OM$OM$Waa,
#CKMR
born_year_old=OM$born_year_old-(OM$fyear_dat-1),
age_diff=OM$age_diff,
n_ckmr=OM$n_ckmr,
k_ckmr_hsp=OM$k_ckmr_hsp,
born_year_young=OM$born_year_young-(OM$fyear_dat-1),
k_ckmr_pop=OM$k_ckmr_pop,
samp_year_old=OM$samp_year_old-(OM$fyear_dat-1))
#Parameters
set.seed(s)
par <- list(log_M=log(runif(1,min=OM$OM$Mref-OM$OM$Mref*0.2,max=OM$OM$Mref+OM$OM$Mref*0.2)),
log_q=log(runif(1,min=OM$q_index-OM$q_index*0.2,max=OM$q_index+OM$q_index*0.2)),
log_recruit_devs_init=rep(0,dat$lage),
log_recruit_devs=rep(0,dat$lyear),
steepness=OM$OM$h,
log_R0=log(runif(1,min=OM$OM$R0-OM$OM$R0*0.2,max=OM$OM$R0+OM$OM$R0*0.2)),
log_sigma_rec=log(OM$OM$sd_rec),
log_sd_catch=log(OM$sd_catch),
log_sd_index=log(OM$sd_index),
Sel_logis_k=log(runif(1,min=OM$OM$Sel_slope-OM$OM$Sel_slope*0.2,max=OM$OM$Sel_slope+OM$OM$Sel_slope*0.2)),
Sel_logis_midpt=log(runif(1,min=OM$OM$Sel_50-OM$OM$Sel_50*0.2,max=OM$OM$Sel_50+OM$OM$Sel_50*0.2)),
log_fint=log(runif(length(OM$OM$F_int[26:100]),min=OM$OM$F_int[26:100]-OM$OM$F_int[26:100]*0.2,max=OM$OM$F_int[26:100]+OM$OM$F_int[26:100]*0.2)))
dyn.load(dynlib("CKMRmultinom_HSP_and_POP_Fisch_wAge0"))
parm_names<-names(MakeADFun(dat, par, DLL="CKMRmultinom_HSP_and_POP_Fisch_wAge0")$par)
fixed<-list(steepness=factor(NA),
log_sd_catch=factor(NA),
log_sd_index=factor(NA))
lower_bounds<-c(-5,-20,rep(-10,dat$lage),rep(-10,dat$lyear), 0, 5, -5,-5,-5,-5,-5,rep(-10,dat$lyear))
upper_bounds<-c( 2,  1,rep( 10,dat$lage),rep( 10,dat$lyear), 1, 25, 2, 2, 2, 5, 5,rep(  0,dat$lyear))
reffects=c("log_recruit_devs","log_recruit_devs_init")
l<-lower_bounds[-which(parm_names %in% c(names(fixed),reffects))]
u<-upper_bounds[-which(parm_names %in% c(names(fixed),reffects))]
SCAA <- MakeADFun(dat, par, DLL="CKMRmultinom_HSP_and_POP_Fisch_wAge0", map=fixed, random=reffects)
SCAA_fit <- TMBhelper::fit_tmb(obj=SCAA, startpar=SCAA$par, lower=l, upper=u, newtonsteps=1, getsd=TRUE,bias.correct=TRUE,getHessian=TRUE)
res_list[[Q]][[s]]<-SCAA_fit
}
}
